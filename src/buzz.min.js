/*!
 * Buzz, a Javascript HTML5 Audio library
 * Licensed under the MIT license.
 * http://buzz.jaysalvat.com/
 * ----------------------------------------------------------------------------
 * Copyright (C) 2013 Jay Salvat
 * http://jaysalvat.com/
 * ----------------------------------------------------------------------------
 * Forked by Gabriel Nahmias
 * gabriel@terrasoftlabs.com on 9/25/2013
 * ----------------------------------------------------------------------------
 */
(function(b,c,a){if(typeof module!=="undefined"&&module.exports){module.exports=a()}else{if(typeof c.define==="function"&&c.define.amd){define(b,[],a)}else{c[b]=a()}}})("buzz",this,function(){var a={defaults:{autoplay:false,duration:5000,formats:[],loop:false,placeholder:"--",preload:"metadata",volume:80,document:document},types:{mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",aac:"audio/aac",m4a:"audio/x-m4a"},sounds:[],el:document.createElement("audio"),sound:function(b,q){q=q||{};var n=q.document||a.defaults.document;var l=0,p=[],d={},c=a.isSupported();this.load=function(){if(!c){return this}this.sound.load();return this};this.play=function(){if(!c){return this}this.sound.play();return this};this.togglePlay=function(){if(!c){return this}if(this.sound.paused){this.sound.play()}else{this.sound.pause()}return this};this.pause=function(){if(!c){return this}this.sound.pause();return this};this.isPaused=function(){if(!c){return null}return this.sound.paused};this.stop=function(){if(!c){return this}this.setTime(0);this.sound.pause();return this};this.isEnded=function(){if(!c){return null}return this.sound.ended};this.loop=function(){if(!c){return this}this.sound.loop="loop";this.bind("ended.buzzloop",function(){this.currentTime=0;this.play()});return this};this.unloop=function(){if(!c){return this}this.sound.removeAttribute("loop");this.unbind("ended.buzzloop");return this};this.mute=function(){if(!c){return this}this.sound.muted=true;return this};this.unmute=function(){if(!c){return this}this.sound.muted=false;return this};this.toggleMute=function(){if(!c){return this}this.sound.muted=!this.sound.muted;return this};this.isMuted=function(){if(!c){return null}return this.sound.muted};this.setVolume=function(i){if(!c){return this}if(i<0){i=0}if(i>100){i=100}this.volume=i;this.sound.volume=i/100;return this};this.getVolume=function(){if(!c){return this}return this.volume};this.increaseVolume=function(i){return this.setVolume(this.volume+(i||1))};this.decreaseVolume=function(i){return this.setVolume(this.volume-(i||1))};this.setTime=function(i){if(!c){return this}var j=true;this.whenReady(function(){if(j===true){j=false;this.sound.currentTime=i}});return this};this.getTime=function(){if(!c){return null}var i=Math.round(this.sound.currentTime*100)/100;return isNaN(i)?a.defaults.placeholder:i};this.setPercent=function(i){if(!c){return this}return this.setTime(a.fromPercent(i,this.sound.duration))};this.getPercent=function(){if(!c){return null}var i=Math.round(a.toPercent(this.sound.currentTime,this.sound.duration));return isNaN(i)?a.defaults.placeholder:i};this.setSpeed=function(i){if(!c){return this}this.sound.playbackRate=i;return this};this.getSpeed=function(){if(!c){return null}return this.sound.playbackRate};this.getDuration=function(){if(!c){return null}var i=Math.round(this.sound.duration*100)/100;return isNaN(i)?a.defaults.placeholder:i};this.getPlayed=function(){if(!c){return null}return o(this.sound.played)};this.getBuffered=function(){if(!c){return null}return o(this.sound.buffered)};this.getSeekable=function(){if(!c){return null}return o(this.sound.seekable)};this.getErrorCode=function(){if(c&&this.sound.error){return this.sound.error.code}return 0};this.getErrorMessage=function(){if(!c){return null}switch(this.getErrorCode()){case 1:return"MEDIA_ERR_ABORTED";case 2:return"MEDIA_ERR_NETWORK";case 3:return"MEDIA_ERR_DECODE";case 4:return"MEDIA_ERR_SRC_NOT_SUPPORTED";default:return null}};this.getStateCode=function(){if(!c){return null}return this.sound.readyState};this.getStateMessage=function(){if(!c){return null}switch(this.getStateCode()){case 0:return"HAVE_NOTHING";case 1:return"HAVE_METADATA";case 2:return"HAVE_CURRENT_DATA";case 3:return"HAVE_FUTURE_DATA";case 4:return"HAVE_ENOUGH_DATA";default:return null}};this.getNetworkStateCode=function(){if(!c){return null}return this.sound.networkState};this.getNetworkStateMessage=function(){if(!c){return null}switch(this.getNetworkStateCode()){case 0:return"NETWORK_EMPTY";case 1:return"NETWORK_IDLE";case 2:return"NETWORK_LOADING";case 3:return"NETWORK_NO_SOURCE";default:return null}};this.set=function(i,j){if(!c){return this}this.sound[i]=j;return this};this.get=function(i){if(!c){return null}return i?this.sound[i]:this.sound};this.bind=function(r,u){if(!c){return this}r=r.split(" ");var j=this,v=function(t){u.call(j,t)};for(var k=0;k<r.length;k++){var s=r[k],i=s;s=i.split(".")[0];p.push({idx:i,func:v});this.sound.addEventListener(s,v,true)}return this};this.unbind=function(s){if(!c){return this}s=s.split(" ");for(var r=0;r<s.length;r++){var j=s[r],v=j.split(".")[0];for(var k=0;k<p.length;k++){var u=p[k].idx.split(".");if(p[k].idx==j||(u[1]&&u[1]==j.replace(".",""))){this.sound.removeEventListener(v,p[k].func,true);p.splice(k,1)}}}return this};this.bindOnce=function(j,k){if(!c){return this}var i=this;d[l++]=false;this.bind(j+"."+l,function(){if(!d[l]){d[l]=true;k.call(i)}i.unbind(j+"."+l)});return this};this.trigger=function(v){if(!c){return this}v=v.split(" ");for(var u=0;u<v.length;u++){var j=v[u];for(var s=0;s<p.length;s++){var r=p[s].idx.split(".");if(p[s].idx==j||(r[0]&&r[0]==j.replace(".",""))){var k=n.createEvent("HTMLEvents");k.initEvent(r[0],false,true);this.sound.dispatchEvent(k)}}}return this};this.fadeTo=function(u,r,t){if(!c){return this}if(r instanceof Function){t=r;r=a.defaults.duration}else{r=r||a.defaults.duration}var s=this.volume,k=r/Math.abs(s-u),j=this;this.play();function i(){setTimeout(function(){if(s<u&&j.volume<u){j.setVolume(j.volume+=1);i()}else{if(s>u&&j.volume>u){j.setVolume(j.volume-=1);i()}else{if(t instanceof Function){t.apply(j)}}}},k)}this.whenReady(function(){i()});return this};this.fadeIn=function(i,j){if(!c){return this}return this.setVolume(0).fadeTo(100,i,j)};this.fadeOut=function(i,j){if(!c){return this}return this.fadeTo(0,i,j)};this.fadeWith=function(j,i){if(!c){return this}this.fadeOut(i,function(){this.stop()});j.play().fadeIn(i);return this};this.whenReady=function(j){if(!c){return null}var i=this;if(this.sound.readyState===0){this.bind("canplay.buzzwhenready",function(){j.call(i)})}else{j.call(i)}};function o(j){var s=[],r=j.length-1;for(var k=0;k<=r;k++){s.push({start:j.start(k),end:j.end(k)})}return s}function m(i){return i.split(".").pop()}function f(j,k){var i=n.createElement("source");i.src=k;if(a.types[m(k)]){i.type=a.types[m(k)]}j.appendChild(i)}if(c&&b){for(var h in a.defaults){if(a.defaults.hasOwnProperty(h)){q[h]=q[h]||a.defaults[h]}}this.sound=n.createElement("audio");if(b instanceof Array){for(var g in b){if(b.hasOwnProperty(g)){f(this.sound,b[g])}}}else{if(q.formats.length){for(var e in q.formats){if(q.formats.hasOwnProperty(e)){f(this.sound,b+"."+q.formats[e])}}}else{f(this.sound,b)}}if(q.loop){this.loop()}if(q.autoplay){this.sound.autoplay="autoplay"}if(q.preload===true){this.sound.preload="auto"}else{if(q.preload===false){this.sound.preload="none"}else{this.sound.preload=q.preload}}this.setVolume(q.volume);a.sounds.push(this)}},group:function(b){b=d(b,arguments);this.getSounds=function(){return b};this.add=function(f){f=d(f,arguments);for(var e=0;e<f.length;e++){b.push(f[e])}};this.remove=function(g){g=d(g,arguments);for(var e=0;e<g.length;e++){for(var f=0;f<b.length;f++){if(b[f]==g[e]){b.splice(f,1);break}}}};this.load=function(){c("load");return this};this.play=function(){c("play");return this};this.togglePlay=function(){c("togglePlay");return this};this.pause=function(e){c("pause",e);return this};this.stop=function(){c("stop");return this};this.mute=function(){c("mute");return this};this.unmute=function(){c("unmute");return this};this.toggleMute=function(){c("toggleMute");return this};this.setVolume=function(e){c("setVolume",e);return this};this.increaseVolume=function(e){c("increaseVolume",e);return this};this.decreaseVolume=function(e){c("decreaseVolume",e);return this};this.loop=function(){c("loop");return this};this.unloop=function(){c("unloop");return this};this.setTime=function(e){c("setTime",e);return this};this.set=function(e,f){c("set",e,f);return this};this.bind=function(e,f){c("bind",e,f);return this};this.unbind=function(e){c("unbind",e);return this};this.bindOnce=function(e,f){c("bindOnce",e,f);return this};this.trigger=function(e){c("trigger",e);return this};this.fade=function(h,g,e,f){c("fade",h,g,e,f);return this};this.fadeIn=function(e,f){c("fadeIn",e,f);return this};this.fadeOut=function(e,f){c("fadeOut",e,f);return this};function c(){var e=d(null,arguments),g=e.shift();for(var f=0;f<b.length;f++){b[f][g].apply(b[f],e)}}function d(f,e){return(f instanceof Array)?f:Array.prototype.slice.call(e)}},all:function(){return new a.group(a.sounds)},isSupported:function(){return !!a.el.canPlayType},isOGGSupported:function(){return !!a.el.canPlayType&&a.el.canPlayType('audio/ogg; codecs="vorbis"')},isWAVSupported:function(){return !!a.el.canPlayType&&a.el.canPlayType('audio/wav; codecs="1"')},isMP3Supported:function(){return !!a.el.canPlayType&&a.el.canPlayType("audio/mpeg;")},isAACSupported:function(){return !!a.el.canPlayType&&(a.el.canPlayType("audio/x-m4a;")||a.el.canPlayType("audio/aac;"))},toTimer:function(f,c){var e,b,d;e=Math.floor(f/3600);e=isNaN(e)?"--":(e>=10)?e:"0"+e;b=c?Math.floor(f/60%60):Math.floor(f/60);b=isNaN(b)?"--":(b>=10)?b:"0"+b;d=Math.floor(f%60);d=isNaN(d)?"--":(d>=10)?d:"0"+d;return c?e+":"+b+":"+d:b+":"+d},fromTimer:function(c){var b=c.toString().split(":");if(b&&b.length==3){c=(parseInt(b[0],10)*3600)+(parseInt(b[1],10)*60)+parseInt(b[2],10)}if(b&&b.length==2){c=(parseInt(b[0],10)*60)+parseInt(b[1],10)}return c},toPercent:function(e,d,b){var c=Math.pow(10,b||0);return Math.round(((e*100)/d)*c)/c},fromPercent:function(e,d,b){var c=Math.pow(10,b||0);return Math.round(((d/100)*e)*c)/c}};return a});